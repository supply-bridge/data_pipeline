
# 统一供应商 ID 与虚拟母公司设计文档

## 🎯 目标
统一不同来源中指向同一真实企业的供应商数据，并支持对多子公司进行“逻辑母公司”归组，方便查询与展示。

---

## 一、统一供应商 ID（Unified Supplier ID, USID）

### 📌 目的
把多个数据源中指向同一企业的供应商记录，合并为统一实体，便于匹配与识别。

### 匹配策略

1. **模糊匹配 + 规则过滤**
   - 使用如 `rapidfuzz`, `strsim` 等库进行字符串相似度计算
   - 结合联系方式（地址、电话、邮箱）进行增强判断
   - 可添加规则处理尾缀：如“有限公司”“子公司”“集团”等

2. **多字段评分模型**
   - 评估多个字段的相似度并加权组合：
     - 名称相似度
     - 地址相似度
     - 联系电话匹配
     - 邮箱域名一致
     - 描述字段 embedding 相似度

3. **基于嵌入向量的语义匹配**
   - 将“公司名称 + 简介”生成 embedding 向量
   - 计算余弦相似度（>0.95 可视为强匹配）

4. **人工校验流程**
   - 系统预判可能重复项
   - 人工确认是否合并
   - 可记录人为判断结果用于模型微调

5. **使用公开企业注册信息**
   - 如启信宝、天眼查、OpenCorporates 等数据源
   - 以统一的注册号/营业执照号为匹配依据（精度极高）

### 数据结构示例

```json
{
  "unified_supplier_id": "sup_1234",
  "sources": [
    {
      "source": "网站A",
      "raw_name": "广州ABC有限公司",
      "score": 0.96
    },
    {
      "source": "网站B",
      "raw_name": "ABC公司广州",
      "score": 0.94
    }
  ],
  "merged_name": "广州ABC有限公司",
  "contact_info": {
    "phone": "400-123-4567",
    "email": "sales@abc.com"
  }
}
```

---

## 二、逻辑母公司（Logical Parent）

### 📌 目的
在真实业务中，供应商常存在多个子公司。为便于匹配和展示，可构造“虚拟母公司”进行统一归类。

### 为什么需要？
- 现实中多个法人公司同属一集团
- 但在展示/搜索/匹配时我们希望它们被视为“同一家公司”

### 原始数据处理方式

- 在抓取/导入阶段：
  - 识别是否存在“集团”、“母公司”等关键词
  - 根据地址或域名相同，尝试归组到一个 `logical_parent_id`

- 数据入库后：
  - 允许人工归组
  - 添加 `parent_type: "logical"` 字段表明是“虚拟母公司”

### 数据结构示例

```json
{
  "logical_parent_id": "group_001",
  "parent_name": "ABC集团（逻辑）",
  "children": [
    {
      "unified_supplier_id": "sup_1234",
      "raw_name": "广州ABC有限公司"
    },
    {
      "unified_supplier_id": "sup_5678",
      "raw_name": "深圳ABC贸易公司"
    }
  ]
}
```

---

## 三、设计原则

- 保留每条数据的原始名称与来源信息
- `unified_supplier_id` 用于数据匹配与主逻辑处理
- `logical_parent_id` 仅用于展示与搜索的抽象层
- 避免强行合并所有公司为逻辑母公司，按需归组

